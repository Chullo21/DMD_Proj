@{
    ViewData["Title"] = "Upload Documents";
    string subj = TempData["Subj"] as string;
    string type = TempData["DocType"] as string;
    string[] EN = TempData["EN"] as string[];
    TempData.Keep();
}
@if (!string.IsNullOrEmpty(TempData["Error"] as string) && TempData["Error"] != null)
{
    <div class="alert alert-danger mt-1 border-3" role="alert">@TempData["Error"].ToString()</div>
}
<form asp-controller="MTI" asp-action="CreateMTI" asp-route-originator="@EN[0]" enctype="multipart/form-data" id="uploaddocumentform">
    <input value="@type" name="doctype" hidden />
    <input value="@subj" name="product" hidden/>
<div class="container-fluid">
    <div class="w-100 card border-dark border-3">
        <div class="card-body d-flex">
            <div class="input-group mx-1">
                <label class="form-label my-auto mx-1">Doc #:</label>
                <div class="d-flex">
                    <input class="form-control" type="text" name="documentnumber" id="docnumber" required autocomplete="off"/>
                    <button class="btn btn-primary" type="button" id="checkdocno">Check</button>
                </div>
            </div>
            <div class="input-group mx-1">
                <label class="form-label my-auto mx-1">Assy #:</label>
                <input class="form-control" name="assynumber" type="text" id="apn" required autocomplete="off" />
            </div>
            <div class="input-group mx-1">
                <label class="form-label my-auto mx-1">Assy. Desc:</label>
                <input class="form-control" type="text" name="assydesc" id="ad" required autocomplete="off" />
            </div>
            <div class="input-group mx-1">
                <label class="form-label my-auto mx-1">Rev. #:</label>
                <input class="form-control" type="text" name="revnumber" id="rn" required autocomplete="off" />
            </div>
            <button class="btn btn-primary" type="submit" id="submitform" disabled>Submit</button>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12 col-lg-5">
            <div class="card w-100 h-auto mt-2">
                <div>
                    <p class="card-header text-center">Documents</p>
                </div>
                <div class="card-body" style="overflow-y:auto; max-height:450px">
                        <div class="my-2 w-100">
                            <div class="d-flex">
                                <label class="form-label my-auto w-100">
                                    @{
                                        Write(type + " Document");
                                    }
                                </label>
                            </div>
                            <input class="form-control w-100" type="file" name="mpti" accept=".pdf" id="mpti" required />
                        </div>
                        <div class="my-2 w-100" style="border-top:2px dotted;">
                            <div class="d-flex">
                                <label class="form-label my-auto w-100">
                                    Assembly Drawing
                                </label>
                            </div>
                            <input class="form-control w-100" type="file" name="assemblydrawing" id="assydrawing" accept=".pdf" />

                        </div>
                        <div class="my-2 w-100" style="border-top:2px dotted;">
                            <div class="d-flex">
                                <label class="form-label my-auto w-100">
                                    Bills Of Material
                                </label>
                            </div>
                            <input class="form-control w-100" type="file" name="billsofmaterial" id="bom" accept=".pdf" />

                        </div>
                        <div class="my-2 w-100" style="border-top:2px dotted;">
                            <div class="d-flex">
                                <label class="form-label my-auto w-100">
                                    Schematic Diagram
                                </label>                               
                            </div>
                            <input class="form-control w-100" type="file" name="schematicdiagram" id="schema" accept=".pdf" />

                        </div>
                        <div class="my-2 w-100" style="border-top:2px dotted;">
                            <div class="d-flex">
                                <label class="form-label my-auto w-100">
                                    O.P.L (Multiple or None)
                                </label>
                            </div>
                            <input class="form-control w-100" type="file" name="onepointlesson" id="opls" accept=".pdf" multiple />

                        </div>
                        <div class="w-100 my-2" style="border-top:2px dotted;">
                            <div class="d-flex">
                                <label class="form-label my-auto w-100">
                                    PRCO (Multiple or None)
                                </label>
                            </div>
                            <input class="form-control w-100" type="file" name="prco" accept=".pdf" id="prcos" multiple />

                        </div>
                        <div class="w-100 my-2" style="border-top:2px dotted;">
                            <label class="form-label my-auto w-100">
                                Derogation (Multiple or None)
                            </label>
                            <input class="form-control w-100" type="file" name="derogation" accept=".pdf" id="derogs" multiple />
                        </div>
                        <div class="w-100 my-2" style="border-top:2px dotted;">
                            <div class="d-flex">
                                <label class="form-label my-auto w-100">
                                    MEMO (Multiple or None)
                                </label>
                            </div>
                            <input class="form-control w-100" type="file" name="engineeringmemo" accept=".pdf" id="memos" multiple />
                        </div>
                    </div>
            </div>
        </div>
        <div class="col-md-12 col-lg-4">
            <div class="card w-100 h-100 mt-2">
                <div class="text-center">
                    <p class="card-header">More</p>
                </div>
                <div class="card-body">
                    <div class="flex-column">
                        <label class="form-label">Action After Traveler</label>
                        <select class="form-select" name="afterTrav" onchange="CheckAfterTrav(this.value)" required>
                            <option selected hidden value="N">None</option>
                            <option value="N">None</option>
                            <option value="C">Configuration Logsheet</option>
                            <option value="T">Test Equipment Log</option>
                        </select>
                    </div>
                    <div id="logsheetDiv">
                        <div class="my-4">
                            <label class="form-label">Logsheet Document Control Number</label>
                            <input class="form-control" name="LogsheetDocNo" value="" id="editDetLogDocNo"/>
                        </div>
                        <div>
                            <label class="form-label">Logsheet Revision Number</label>
                            <input class="form-control" name="LogsheetRevNo" value="" id="editDetLogRevNo" />
                        </div>
                    </div>
                    <div class="mt-5">
                        <i>Note: Please Select which logsheet should be asked to the technicians after their traveler.</i>
                    </div>
                </div>            
            </div>
        </div>
        <div class="col-md-12 col-lg-3">
            <div class="card w-100 h-100 mt-2">
                <div class="text-center">
                    <p class="card-header">Traveler</p>
                </div>
                    <div class="card-body" style="max-height:400px; overflow-y:auto">
                        <div class="flex-column">
                            <label class="form-label">Traveler</label>
                            <input class="form-control" type="file" accept=".xlsx" name="TravelerFile" id="traveler" required/>
                        </div>
                    <div>
                        <div class="mt-5">
                            <i>Note: Please follow the proper template for traveler.</i>
                        </div>
                    </div>
                </div>
            </div>            
        </div>
    </div>
</div>
</form>

<script>
    window.onload = function () {
        CheckAfterTrav('N');
    };

    function CheckAfterTrav(val)
    {
        var docNoInput = document.getElementById('editDetLogDocNo');
        var revNoInput = document.getElementById('editDetLogRevNo');
        var logSheetDiv = document.getElementById('logsheetDiv');

        if (val === 'N') {
            logSheetDiv.style.display = 'none';
            docNoInput.removeAttribute('required');
            revNoInput.removeAttribute('required');
            docNoInput.value = '';
            revNoInput.value = '';
        } else {
            logSheetDiv.style.display = 'block';
            docNoInput.setAttribute('required', '');
            revNoInput.setAttribute('required', '');
        }
    }

    $(function (){
        $('#checkdocno').click(function (e){
            e.preventDefault();

            if (document.getElementById('docnumber').value !== '')
            {
                $.ajax({
                    url: '@Url.Action("ValidateDocNo", "MTI")',
                    data: { DocNo: document.getElementById('docnumber').value },
                    success: function (r) {
                        $('#checkmodal').modal('show');

                        if (r.Failed === '') {
                            document.getElementById('checkmodalbody').innerHTML = 'Document number does not exist, feel free to continue.';
                            document.getElementById('checkmodaltitle').innerHTML = 'Safe';
                            document.getElementById('docnumber').readOnly = true;
                            document.getElementById('submitform').disabled = false;
                        }
                        else {
                            document.getElementById('checkmodalbody').innerHTML = r.Failed;
                            document.getElementById('checkmodaltitle').innerHTML = 'Warning';
                            $('#docnumber').val('');
                            document.getElementById('docnumber').readOnly = false;
                            document.getElementById('submitform').disabled = true;
                        }
                    }
                });
            }
        });
    });
</script>

<div class="modal fade" data-bs-backdrop="static" id="checkmodal">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <p class="modal-title fs-5 fw-bold text-center w-100" id="checkmodaltitle"></p>
            </div>
            <div class="modal-body" id="checkmodalbody">
                
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" data-bs-dismiss="modal">Okay</button>
            </div>
        </div>
    </div>
</div>


